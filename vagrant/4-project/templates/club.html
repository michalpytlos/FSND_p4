{% extends "base.html" %}
{% block content %}
<header>
  <h1>Board game club</h1>
</header>
<main>
  <div>
    <img src="{{ club.picture if club.picture != None }}" alt="Profile picture" width=50%>
    <p class="update-hide">{{ club.about if club.about != None }}</p>
    {% if owner %}
    <form class="ajax-form hidden">
      <input type="hidden" name="url" value="{{ url_for('club_') }}">
      <input type="hidden" name="redirect" value="{{ url_for('home') }}">
      <input type="hidden" name="method" value="PATCH">
      <input type="hidden" name="type" value="club">
      <input type="hidden" name="id" value=1>
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      <label for="profile-picture">URL of the club's profile picture</label>
      <input type="text" name="picture" value="{{ club.picture if club.picture != None }}"><br><br>
      <textarea name="about" placeholder="Few words about the club..." rows="4" cols="50">{{ club.about if club.about != None }}</textarea><br>
      <input type="submit" value="Submit changes">
    </form>
    <button value="Edit" onclick="updateToggle(this)">Edit</button>
    {% endif %}
  <div>

  <h3>Posts</h3>
  {% if signed_in %}
  <a href="{{ url_for('post_add') }}">Add new post</a>
  {% endif %}
  {%  for post in posts %}
  <div>
    <div>{{ post['subject'] }}</div>
    <span>{{ post['author'] }}</span>
    <span>Posted {{ post['posted'] }} (UTC)</span>
    <div>
      {% if post['edited'] %}
        Edited {{ post['edited']}}
      {% endif %}
    </div>
    <div class="update-hide">{{ post['body'] }}</div>
    {% if post['owner'] %}
    <form class="ajax-form hidden">
      <input type="hidden" name="url" value="{{ url_for('post_', post_id=post['id']) }}">
      <input type="hidden" name="redirect" value="{{ url_for('home') }}">
      <input type="hidden" name="method" value="PATCH">
      <input type="hidden" name="type" value="post">
      <input type="hidden" name="id" value="{{ post['id'] }}">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      <textarea name="body" rows="4" cols="50">{{ post['body'] }}</textarea><br>
      <input type="submit" value="Submit changes">
    </form>
    <button value="Edit" onclick="updateToggle(this)">Edit</button>
    <form class="ajax-form">
      <input type="hidden" name="url" value="{{ url_for('post_', post_id=post['id']) }}">
      <input type="hidden" name="redirect" value="{{ url_for('home') }}">
      <input type="hidden" name="method" value="DELETE">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
      <input type="submit" value="Delete">
      {% endif %}
    </form>
  </div>
  <br>
  {% endfor %}

  <h3>Members</h3>
  <ul>
    {% for member in members %}
    <li><a href="{{ url_for('profile_', user_id=member.id) }}">{{ member.name }}</a></li>
    {% endfor %}
  </ul>
  <p>Club's games</p>
  <table>
    <tr>
      <th>Game</th>
      <th>Players</th>
      <th>Playing time</th>
      <th>Complexity</th>
      <th>Category</th>
      <th>User Rating</th>
      <th>BGG Rating</th>
    </tr>
    {% for game in games %}
    <tr>
      <td><a href="{{ url_for('game_', game_id=game.id) }}">{{ game.name }}</a></td>
      <td>{{ game.min_players }}-{{ game.max_players }}</td>
      <td>
        {% if game.min_playtime == game.max_playtime %}
          {{ game.min_playtime }}min
        {% else %}
          {{ game.min_playtime }} - {{ game.max_playtime }}min
        {% endif %}
      </td>
      <td>{{ game.weight }}</td>
      <td>
        {% for category in  categories[game.id|string()] %}
          {{ category }}
        {% endfor %}
      </td>
      <td></td>
      <td>{{ game.bgg_rating }}</td>
      <td>
        {% if owner %}
        <form class="ajax-form">
          <input type="hidden" name="url" value="{{ url_for('club_game_', game_id=game.id) }}">
          <input type="hidden" name="redirect" value="{{ url_for('home') }}">
          <input type="hidden" name="method" value="DELETE">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
          <input type="submit" value="Delete">
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
  {% if owner %}
  <form action="{{ url_for('club_game_add') }}" method="get">
    <input type=text name="name" value="">
    <input type="submit" value="Add game">
  </form >
  {% endif %}
</main>

{% endblock %}
